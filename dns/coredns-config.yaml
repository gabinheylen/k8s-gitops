apiVersion: v1
kind: ConfigMap
metadata:
  name: coredns-config
  namespace: dns
data:
  Corefile: |
    .:53 {
        errors
        health {
          lameduck 5s
        }
        ready
        log
        
        # RÃ©solution des domaines .local
        template IN A longhorn.local {
          answer "{{ .Name }} 60 IN A 192.168.1.230"
          fallthrough
        }
        
        template IN A argocd.local {
          answer "{{ .Name }} 60 IN A 192.168.1.230"
          fallthrough
        }
        
        template IN A vaultwarden.local {
          answer "{{ .Name }} 60 IN A 192.168.1.230"
          fallthrough
        }
        
        template IN A dns.local {
          answer "{{ .Name }} 60 IN A 192.168.1.231"
          fallthrough
        }
        
        # Forward vers les DNS publics pour les autres domaines
        forward . 8.8.8.8 1.1.1.1
        
        cache 30
        loop
        reload
        loadbalance
    }
